{% extends "base.html" %}

{% block title %}{{ product.name }} - Shop{% endblock %}

{% block content %}
<div class="product-detail">
    <div class="product-image-large">
        {% if product.image_url %}
            <img src="/static/images/{{ product.image_url }}" alt="{{ product.name }}">
        {% else %}
            <div class="product-placeholder-large">ðŸ“¦</div>
        {% endif %}
    </div>
    
    <div class="product-info">
        <h1>{{ product.name }}</h1>
        <p class="product-price-large">${{ "%.2f"|format(product.price) }}</p>
        <p class="product-description">{{ product.description }}</p>
        <p class="product-stock">Available: {{ product.stock }} units</p>
        
        {% if session.user_id %}
            <form method="POST" action="/checkout" class="checkout-form">
                <input type="hidden" name="product_id" value="{{ product.id }}">
                
                <!-- VULNERABLE: Price sent from client -->
                <input type="hidden" name="price" value="{{ product.price }}" id="price-field">
                
                <div class="form-group">
                    <label for="quantity">Quantity:</label>
                    <input type="number" id="quantity" name="quantity" value="1" min="1" max="{{ product.stock }}" required>
                </div>
                
                <button type="submit" class="btn btn-large">Purchase Now</button>
            </form>
            
            <div class="hint-box">
                <h4>ðŸ’° Price Manipulation Vulnerability!</h4>
                <p>Open browser DevTools (F12), go to Elements/Inspector</p>
                <p>Find: <code>&lt;input type="hidden" name="price" value="{{ product.price }}"&gt;</code></p>
                <p>Change the value to: <code>0.01</code></p>
                <p>Then click "Purchase Now" - you'll buy it for $0.01!</p>
                <br>
                <p><strong>Or use Console:</strong></p>
                <code>document.getElementById('price-field').value = '0.01'</code>
            </div>
        {% else %}
            <p><a href="/login" class="btn">Login to Purchase</a></p>
        {% endif %}
    </div>
</div>
{% endblock %}
